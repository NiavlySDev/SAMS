# D√©ploiement SAMS - Production

## Instructions de d√©ploiement

### 1. Upload des fichiers
- T√©l√©chargez tous les fichiers sur votre serveur Infomaniak
- Assurez-vous que le fichier `config/config.json` contient les bonnes informations de connexion

### 2. Configuration de la base de donn√©es
Les param√®tres de connexion Infomaniak sont d√©j√† configur√©s :
- Host: we01io.myd.infomaniak.com
- Database: we01io_sams
- User: we01io_sams

### 3. Initialisation (premi√®re fois uniquement)

#### Option A: Initialisation automatique depuis les JSON (RECOMMAND√â)
Visitez : `https://votre-domaine.com/AideSAMS/api/init-from-json.php`

Cette URL va :
- Cr√©er automatiquement toutes les tables
- Charger TOUTES les donn√©es depuis les fichiers JSON
- Initialiser les grades avec leurs membres
- Importer les manuels, cat√©gories, sp√©cialit√©s, blippers et zones GTA5

R√©ponse attendue :
```json
{
  "status": "success",
  "message": "Base de donn√©es initialis√©e avec succ√®s depuis les JSON",
  "results": {
    "blippers": "8 blippers import√©s",
    "categories": "5 cat√©gories import√©es",
    "specialites": "5 sp√©cialit√©s import√©es",
    "grades": "7 grades et 6 membres import√©s",
    "manuels": "34 manuels import√©s",
    "gta5_zones": "1 zones import√©es"
  }
}
```

#### Option B: SQL personnalis√©
Si vous pr√©f√©rez utiliser phpMyAdmin :
1. Ex√©cutez les CREATE TABLE depuis `AideSAMS/api/init-db.sql`
2. Ex√©cutez le script PHP : `init-from-json.php`

### 4. Test de connexion

- **Simple** : `https://votre-domaine.com/AideSAMS/api/ping.php`
- **D√©taill√©** : `https://votre-domaine.com/AideSAMS/api/db.php?action=check`
- **Complet du syst√®me** : `https://votre-domaine.com/AideSAMS/api/test-system.php` (RECOMMAND√â)

### 5. V√©rification de l'application
Visitez : `https://votre-domaine.com/AideSAMS/`

Console JS : Vous devriez voir :
```
‚úÖ Connexion BDD √©tablie - Synchronisation active
üìç Serveur: we01io.myd.infomaniak.com | Base: we01io_sams
```

## Structure des donn√©es

### Tables cr√©√©es
- `blippers` : Les blippers du syst√®me (8 √©l√©ments)
- `categories` : Cat√©gories de manuels (5 √©l√©ments)
- `specialites` : Sp√©cialit√©s m√©dicales (5 √©l√©ments)
- `grades` : Grades des employ√©s (7 √©l√©ments)
- `membres_grades` : Association grades-employ√©s
- `manuels` : Manuels et guides (34 √©l√©ments)
- `gta5_zones` : Zones de la carte GTA5

### Donn√©es import√©es depuis JSON
Tous les fichiers JSON du dossier `AideSAMS/json/` sont charg√©s :
- `blippers.json`
- `categories.json`
- `specialites.json`
- `grades.json` (avec structure `grade` et `membres`)
- `manuels.json`
- `gta5-zones.json`

## Fichiers importants pour la production
- `config/config.json` : Identifiants Infomaniak (PROT√âG√â)
- `AideSAMS/api/db.php` : API principale avec gestion BDD
- `AideSAMS/api/init-from-json.php` : Initialisation depuis JSON
- `AideSAMS/api/ping.php` : Test simple de connexion
- `AideSAMS/js/data-sync.js` : Synchronisation c√¥t√© client

## S√©curit√© et optimisations
- Dossier `config/` prot√©g√© par `.htaccess`
- Logs d'erreurs activ√©s, affichage public d√©sactiv√©
- Connexion avec retry automatique (2 tentatives)
- Timeout optimis√© pour Infomaniak (20 secondes)
- Gestion propre des erreurs de connexion
- Mode fallback automatique si BDD indisponible

## Debugging en cas de probl√®me

1. **V√©rifier les logs PHP** du serveur Infomaniak
2. **Tester la connexion** :
   - `/api/ping.php` ‚Üí test simple
   - `/api/db.php?action=check` ‚Üí test d√©taill√©
3. **Ouvrir la console navigateur** (F12) pour voir les messages SAMS
4. **V√©rifier** `config/config.json` :
   - Les identifiants sont corrects
   - Le fichier existe
   - Les permissions sont bonnes

## R√©initialisation compl√®te de la base de donn√©es
Si vous devez r√©initialiser :
1. Allez sur `/api/init-from-json.php`
2. Cela va vider et recharger TOUTES les tables
